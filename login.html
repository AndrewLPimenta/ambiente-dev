
<style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    form { background: #fff; padding: 20px; border-radius: 8px; max-width: 400px; margin: auto; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input { width: 100%; padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 10px; width: 100%; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
<form id="loginForm">
    <input type="email" id="email" placeholder="E-mail" required>
    <input type="password" id="senha" placeholder="Senha" required>
    <button type="submit">Entrar</button>
  </form>
  
  <p id="mensagem" style="color: red;"></p>
  
<script>
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = document.getElementById("email").value;
  const senha = document.getElementById("senha").value;

  try {
    const response = await fetch("http://localhost:3001/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, senha })
    });

    const data = await response.json();

    if (!response.ok) {
      document.getElementById("mensagem").textContent = data.message || "Erro ao fazer login";
      return;
    }

    // Salva token e id
    localStorage.setItem("token", data.data.token);
    localStorage.setItem("userId", data.data.user.id);

    // Redirecionamento direto com base no que veio do login
    if (!data.data.respondeu) {
      window.location.href = `form.html?usuario=${data.data.user.id}`;
    } else if (data.data.perfil) {
      const perfil = data.data.perfil.toLowerCase();
      window.location.href = `perfil_${perfil}.html`;
    } else {
      // fallback caso algo falhe
      window.location.href = `form.html?usuario=${data.data.user.id}`;
    }

  } catch (error) {
    document.getElementById("mensagem").textContent = "Erro de conex√£o com o servidor";
  }
});
</script>
